{"ast":null,"code":"import { HttpEvent, HttpHandler, HttpRequest } from \"@angular/common/http\";\nimport { catchError, throwError } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/snack-bar\";\nimport * as i2 from \"./api.service\";\nimport * as i3 from \"ngx-toastr\";\nvar Interceptor = /** @class */function () {\n  function Interceptor(_snackBar, api, toastr) {\n    this._snackBar = _snackBar;\n    this.api = api;\n    this.toastr = toastr;\n    this.tokken = [];\n    this.refresh = [];\n    this.userConn = localStorage.getItem(\"user_conn\") !== undefined ? JSON.parse(localStorage.getItem(\"user_conn\")) : null;\n    this.tokken = localStorage.getItem(\"token\") !== undefined ? JSON.parse(localStorage.getItem(\"token\")) : null;\n  }\n  Interceptor.prototype.intercept = function (request, next) {\n    var _this = this;\n    return next.handle(request).pipe(catchError(function (err) {\n      _this.err = err.error;\n      _this.status = err.status;\n      _this.error_code = _this.err.resp;\n      console.log(_this.error_code);\n      _this.toastr.warning(_this.err.resp);\n      var cadenaResultado = _this.error_code.toString();\n      switch (cadenaResultado) {\n        //CODIGOS DE EXITO\n        case \"202\":\n          _this._snackBar.open('¬° Guardado con Exito !', '‚úÖ', {\n            duration: 2300,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        //ERRORES EXCEPCIONES LOGIN\n        case \"201\":\n          _this._snackBar.open('¬° No se encontro los datos proporcionados !', 'ü§®', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"203\":\n          _this._snackBar.open('¬° Contrase√±a Erronea !', 'üò†', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"205\":\n          _this._snackBar.open('¬° Su contrase√±a ya vencio, registre una nueva !', 'üõ°Ô∏è', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          _this.api.refrescarContrasenia();\n          break;\n        case \"207\":\n          _this._snackBar.open('¬° Usuario NO ACTIVO, Informe al Dpto. de Sistemas !', 'üò•', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"209\":\n          _this._snackBar.open('¬° La contrase√±a  no cumple los requisitos !', '‚ùå', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"211\":\n          _this._snackBar.open('¬° La contrase√±a no puede ser la misma !', '‚ùå', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"213\":\n          _this._snackBar.open('¬° No se encontro un registro con los datos proporcionados (rol). !', '‚ùå', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"215\":\n          _this._snackBar.open('¬° La Contrase√±a ah expirado su VENCIMIENTO, favor consulte al DIOS DEL SISTEMA !', '‚ùå', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"701\":\n          _this._snackBar.open('¬° No hay Tipo de Cambio para el dia de Hoy!', 'üò•', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"713\":\n          _this._snackBar.open('¬° Contrase√±a Incorrecta !', '‚ùå', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n        case \"715\":\n          _this._snackBar.open('¬° PERSONA YA ESTA EN LA LISTA !', '‚ùå', {\n            duration: 6000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n      }\n      switch (_this.status) {\n        case 401:\n          _this.refreshToken();\n          _this._snackBar.open('¬° Usuario SIN AUTORIZACION, Falta de Token !', 'üö´', {\n            duration: 3000,\n            panelClass: ['coorporativo-snackbar', 'login-snackbar']\n          });\n          break;\n      }\n      // switch(this.status){\n      //     case 404:\n      //         this._snackBar.open('¬° Usuario SIN AUTORIZACION, Falta de Token !', 'üö´', {\n      //             duration: 3000,\n      //             panelClass: ['coorporativo-snackbar', 'login-snackbar'],\n      //         });\n      //         break;\n      // }\n      var error = err.error.message || err.statusText;\n      console.log(error);\n      return throwError(error);\n    }));\n  };\n  Interceptor.prototype.refreshToken = function () {\n    var _this = this;\n    var data = {\n      user: this.userConn,\n      token: this.tokken.token\n    };\n    console.log(data);\n    var errorMessage = \"La Ruta presenta fallos al hacer la creacion\" + \"Ruta:- /seg_adm/login/refreshToken/\";\n    return this.api.create(\"/seg_adm/login/refreshToken/\" + this.userConn, data).subscribe({\n      next: function (datav) {\n        _this.refresh = datav;\n        console.log('data', datav);\n      },\n      error: function (err) {\n        console.log(err, errorMessage);\n      },\n      complete: function () {}\n    });\n  };\n  Interceptor.…µfac = function Interceptor_Factory(t) {\n    return new (t || Interceptor)(i0.…µ…µinject(i1.MatSnackBar), i0.…µ…µinject(i2.ApiService), i0.…µ…µinject(i3.ToastrService));\n  };\n  Interceptor.…µprov = /*@__PURE__*/i0.…µ…µdefineInjectable({\n    token: Interceptor,\n    factory: Interceptor.…µfac,\n    providedIn: 'root'\n  });\n  return Interceptor;\n}();\nexport { Interceptor };","map":{"version":3,"mappings":"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","names":["HttpEvent","HttpHandler","HttpRequest","catchError","throwError","_snackBar","api","toastr","userConn","localStorage","getItem","undefined","JSON","parse","tokken","Interceptor","request","next","handle","pipe","_this","err","error","status","error_code","resp","console","log","warning","cadenaResultado","toString","open","duration","panelClass","refrescarContrasenia","refreshToken","message","statusText","data","user","token","errorMessage","create","subscribe","datav","refresh","complete","factory","providedIn"],"sourceRoot":"","sources":["C:\\laragon\\www\\SIAW-Angular-B\\src\\app\\services\\interceptor.ts"],"sourcesContent":["import { HttpEvent, HttpHandler, HttpRequest, HttpInterceptor } from \"@angular/common/http\";\r\nimport { Injectable } from \"@angular/core\";\r\nimport { MatSnackBar } from \"@angular/material/snack-bar\";\r\nimport { Observable, catchError, throwError } from \"rxjs\";\r\nimport { ApiService } from \"./api.service\";\r\nimport { ToastrService } from \"ngx-toastr\";\r\n\r\n@Injectable({providedIn:'root'})\r\nexport class Interceptor implements HttpInterceptor {\r\n    \r\n    public err;\r\n    public status;\r\n    public error_code: number;\r\n    public userConn: string;\r\n    public tokken: any = [];\r\n    public refresh: any = [];\r\n\r\n    constructor(public _snackBar: MatSnackBar, public api: ApiService, private toastr: ToastrService) {\r\n        this.userConn = localStorage.getItem(\"user_conn\") !== undefined ? JSON.parse(localStorage.getItem(\"user_conn\")) : null;\r\n        this.tokken = localStorage.getItem(\"token\") !== undefined ? JSON.parse(localStorage.getItem(\"token\")) : null;\r\n    \r\n    }\r\n\r\n    intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>>{\r\n        return next.handle(request).pipe(catchError(err => {\r\n            this.err = err.error;\r\n            this.status = err.status;\r\n            this.error_code = this.err.resp\r\n\r\n            console.log(this.error_code);\r\n            \r\n            this.toastr.warning(this.err.resp);\r\n            let cadenaResultado: string = this.error_code.toString();\r\n            \r\n            switch(cadenaResultado){\r\n                //CODIGOS DE EXITO\r\n                case \"202\":\r\n                    this._snackBar.open('¬° Guardado con Exito !', '‚úÖ', {\r\n                        duration: 2300,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n                \r\n                //ERRORES EXCEPCIONES LOGIN\r\n                case \"201\":\r\n                    this._snackBar.open('¬° No se encontro los datos proporcionados !', 'ü§®', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n\r\n                case \"203\":                    \r\n                    this._snackBar.open('¬° Contrase√±a Erronea !', 'üò†', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n\r\n                case \"205\":\r\n                    this._snackBar.open('¬° Su contrase√±a ya vencio, registre una nueva !', 'üõ°Ô∏è', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    this.api.refrescarContrasenia();\r\n                    break;\r\n\r\n                case \"207\":\r\n                    this._snackBar.open('¬° Usuario NO ACTIVO, Informe al Dpto. de Sistemas !', 'üò•', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n                \r\n                case \"209\":\r\n                    this._snackBar.open('¬° La contrase√±a  no cumple los requisitos !', '‚ùå', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n                \r\n                case \"211\":\r\n                    this._snackBar.open('¬° La contrase√±a no puede ser la misma !', '‚ùå', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n            \r\n                case \"213\":\r\n                    this._snackBar.open('¬° No se encontro un registro con los datos proporcionados (rol). !', '‚ùå', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n                \r\n                case \"215\":\r\n                    this._snackBar.open('¬° La Contrase√±a ah expirado su VENCIMIENTO, favor consulte al DIOS DEL SISTEMA !', '‚ùå', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n\r\n                case \"701\":\r\n                    this._snackBar.open('¬° No hay Tipo de Cambio para el dia de Hoy!', 'üò•', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n                \r\n                case \"713\":\r\n                    this._snackBar.open('¬° Contrase√±a Incorrecta !', '‚ùå', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n                \r\n                case \"715\":\r\n                    this._snackBar.open('¬° PERSONA YA ESTA EN LA LISTA !', '‚ùå', {\r\n                        duration: 6000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n            }\r\n\r\n            switch(this.status){\r\n                case 401:\r\n                    this.refreshToken();\r\n\r\n                    this._snackBar.open('¬° Usuario SIN AUTORIZACION, Falta de Token !', 'üö´', {\r\n                        duration: 3000,\r\n                        panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n                    });\r\n                    break;\r\n            }\r\n\r\n            // switch(this.status){\r\n            //     case 404:\r\n            //         this._snackBar.open('¬° Usuario SIN AUTORIZACION, Falta de Token !', 'üö´', {\r\n            //             duration: 3000,\r\n            //             panelClass: ['coorporativo-snackbar', 'login-snackbar'],\r\n            //         });\r\n            //         break;\r\n            // }\r\n\r\n            const error = err.error.message || err.statusText;\r\n            console.log(error);\r\n            \r\n            return throwError(error);\r\n        }))\r\n    }\r\n\r\n    refreshToken() {\r\n        const data = { user: this.userConn, token: this.tokken.token };\r\n        \r\n        console.log(data);\r\n\r\n        let errorMessage = \"La Ruta presenta fallos al hacer la creacion\"+\"Ruta:- /seg_adm/login/refreshToken/\";\r\n        return this.api.create(\"/seg_adm/login/refreshToken/\"+this.userConn, data)\r\n        .subscribe({\r\n            next: (datav) => {\r\n            this.refresh = datav;\r\n                console.log('data', datav);\r\n            },\r\n        \r\n            error: (err) => { \r\n            console.log(err, errorMessage);\r\n            },\r\n            complete: () => { }\r\n        })\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}